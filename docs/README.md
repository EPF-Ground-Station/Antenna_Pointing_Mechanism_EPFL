# Documentation

In this folder are stored the files used by Sphinx to auto-generate the documentation hosted by ReadTheDocs.org.

## Getting Started

The documentation is generated by Sphinx, an application that parses the docstrings in all the Python files of the
project. Sphinx generates an index and links between docstrings in order to create a dynamic documentation convertible
to HTML. Sphinx is either run locally or by the ReadTheDocs compiler prior to updating the web page on which the
documentation is hosted.

### QuickStart

Prior to compiling, all the necessary files must be created properly. A good, straightforward approach consists in
creating a ``docs`` subfolder in the root folder of the project, then run ``sphinx-quickstart`` in this folder. If you are 
on Windows (e.g. in EL-B 216), this is performed from the anaconda console. Otherwise you must install Sphinx beforehand. 
This shall create the makefiles, along with the ``build`` and ``source`` subfolders, and the ``conf.py`` file (see below).

For more about sphinx quickstart, you can refer to the documentation : https://www.sphinx-doc.org/en/master/usage/quickstart.html
or to this video (in French) : https://www.youtube.com/watch?v=FcbXzWKKmQY&ab_channel=EnriqueLeblanc

### Apidoc

Next step is to generate the ReStructured Text (.rst) files that will serve to generate the docs. This is automatically
done by running the ``sphinx-apidoc -o docs/source .`` command in the root directory of the project (if you chose to
separate build and source files ; otherwise exclude the ``/source`` from the command). Sphinx shall automatically parse
all the docstrings contained in the .py files of all subdirectories and create appropriate ``.rts`` files.

## Docstrings

As mentioned above, Sphinx relies on the docstrings written directly in the ```.py``` files to generate the documentation.
A docstring is a string located at the beginning of a file, or a class/function definition. It is enclosed within three
quotes ("""). 

Those docstrings are formatted following rules of ReStructured Text (RST). The most useful features are e.g. the declaration
of parameters and their types using the 

```
:param {my_param}: {Short description of my_param usage}
:type {my_param}: {type of my_param}
```

format. Many other features are enabled by this framework and used along the project, such as return variables and types.

The advantage of this approach is docstrings are more convenient to write on the fly of coding, than spending hours
documenting several months-old code no one remembers anymore. Please write docstrings to your functions. *L'intendance suivra !*

Notice Sphinx does not care about comments beginning with a #. Focus on docstrings. This does NOT mean to stop
commenting your code - you comment your code, right?

## Requirements

In the requirements.txt file is the list of the packages to be installed prior to running Sphinx. This is necessary for 
the ReadTheDocs compiler to successfully retrieve the project's dependencies, which are in turn imported prior to
executing the autodocumentation.

The actual methods contained in the modules imported are not needed for parsing. This is why all modules non-linked to 
the documentation formatting (in our case furo, which sets the theme of the documentation generated by sphinx) are
mocked in the file source/conf.py at lines :

```autodoc_mock_imports = [...]```

```sys.modules['numpy'] = MagicMock()```

## The configuration file

```conf.py``` is the file where the configuration of sphinx is set up prior to compilation of the docs. It contains
styling commands, along with extensions specifications, etc. More about this file on Sphinx documentation :
https://www.sphinx-doc.org/en/master/index.html .

## ReStructured Text files

The ```.rts``` files are dynamic, WYSIWYG - driven text files which represent the structure of the HTML file to be compiled.
Including the name of a ```.rts``` file in`another will insert the content of the latter at the place in the HTML
represented by the former, and *tutti quanti*.

For more about RST, check the documentation : https://www.sphinx-doc.org/en/master/usage/restructuredtext/index.html

## ReadTheDocs

ReadTheDocs.org is a free platform for hosting documentation of open-source code. It directly compiles HTML from the
```docs``` subfolder of a GitHub repository, hence the importance to follow closely the procedures explained above.

In the root folder of the project stands the ```.readthedocs.yaml``` file, necessary for the compilation. It specifies
the version of python in use within the project, the path to the requirements file, among other things.

To update the web page, the changes brought in the code (and thus to docstrings - you wrote docstrings, right?) simply
have to be pushed to GitHub (for EL-B 216 users : use either pycharm *commit* tab or GitHub Desktop). Then connect to
ReadTheDocs (password owned by Callista) and launch compilation.

## Troubleshooting

Beware that sphinx still compiles HTML even when meeting hard errors. Those are excepted and logged as warnings, though 
they prevent from compiling the docs of the python file of interest. This leads to empty pages within the HTML. On ReadTheDocs, you can check the end of the log file
after compilation under the *see sources* (*Voir les sources* en fran√ßais) to see what is causing the problem. Minor details can
prevent from compilation, such as endlines without indents in the ```:params[...]:``` blocks.
